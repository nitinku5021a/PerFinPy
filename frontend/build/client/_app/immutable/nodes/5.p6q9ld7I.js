import{s as z,r as J,o as K}from"../chunks/scheduler.DXwQMlsl.js";import{S as Q,i as R,d as f,m as W,n as X,o as $,a as v,b as k,q as tt,r as Z,k as C,c as y,l as x,g as D,e as F,f as G,v as et,h as E,j as L,t as V,w as nt,s as st}from"../chunks/index.BwbdioCG.js";import{f as rt,a as ot}from"../chunks/format.j6oJxotq.js";import{N as lt}from"../chunks/NetworthMatrixTable.CwFbBUxZ.js";function H(o){let l,n;return{c(){l=E("p"),n=V(o[4]),this.h()},l(u){l=y(u,"P",{class:!0});var e=F(l);n=G(e,o[4]),e.forEach(f),this.h()},h(){C(l,"class","danger")},m(u,e){v(u,l,e),k(l,n)},p(u,e){e&16&&st(n,u[4])},d(u){u&&f(l)}}}function at(o){let l,n="Income Statement",u,e,d="Monthly income and expenses for the last 12 months.",S,b,h,N,m,B,T,_,U,O,q,a,s,c,w,p,g,I,P,i=o[4]&&H(o);return p=new lt({props:{groups:o[7],months:o[1],formatValue:rt,drillMode:"month",networthLabel:"NET SAVINGS",networthByMonth:o[12]()}}),{c(){l=E("h1"),l.textContent=n,u=L(),e=E("p"),e.textContent=d,S=L(),i&&i.c(),b=L(),h=E("div"),N=E("label"),m=E("input"),B=V(`\r
     Show Zero Balances`),T=L(),_=E("button"),U=V("Prev 12"),q=L(),a=E("button"),s=V("Next 12"),w=L(),nt(p.$$.fragment),this.h()},l(t){l=y(t,"H1",{class:!0,"data-svelte-h":!0}),x(l)!=="svelte-ha586n"&&(l.textContent=n),u=D(t),e=y(t,"P",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-1t25gdt"&&(e.textContent=d),S=D(t),i&&i.l(t),b=D(t),h=y(t,"DIV",{class:!0});var r=F(h);N=y(r,"LABEL",{});var M=F(N);m=y(M,"INPUT",{type:!0}),B=G(M,`\r
     Show Zero Balances`),M.forEach(f),T=D(r),_=y(r,"BUTTON",{class:!0});var j=F(_);U=G(j,"Prev 12"),j.forEach(f),q=D(r),a=y(r,"BUTTON",{class:!0});var A=F(a);s=G(A,"Next 12"),A.forEach(f),r.forEach(f),w=D(t),et(p.$$.fragment,t),this.h()},h(){C(l,"class","page-title"),C(e,"class","page-subtitle"),C(m,"type","checkbox"),C(_,"class","button"),_.disabled=O=!o[5],C(a,"class","button"),a.disabled=c=!o[6],C(h,"class","toolbar")},m(t,r){v(t,l,r),v(t,u,r),v(t,e,r),v(t,S,r),i&&i.m(t,r),v(t,b,r),v(t,h,r),k(h,N),k(N,m),m.checked=o[2],k(N,B),k(h,T),k(h,_),k(_,U),k(h,q),k(h,a),k(a,s),v(t,w,r),tt(p,t,r),g=!0,I||(P=[Z(m,"change",o[9]),Z(_,"click",o[10]),Z(a,"click",o[11])],I=!0)},p(t,[r]){t[4]?i?i.p(t,r):(i=H(t),i.c(),i.m(b.parentNode,b)):i&&(i.d(1),i=null),r&4&&(m.checked=t[2]),(!g||r&32&&O!==(O=!t[5]))&&(_.disabled=O),(!g||r&64&&c!==(c=!t[6]))&&(a.disabled=c);const M={};r&128&&(M.groups=t[7]),r&2&&(M.months=t[1]),r&3&&(M.networthByMonth=t[12]()),p.$set(M)},i(t){g||($(p.$$.fragment,t),g=!0)},o(t){X(p.$$.fragment,t),g=!1},d(t){t&&(f(l),f(u),f(e),f(S),f(b),f(h),f(w)),i&&i.d(t),W(p,t),I=!1,J(P)}}}function ct(o){const[l,n]=o.split("-");return new Date(Number(l),Number(n)-1,1).toLocaleString("en-US",{month:"short",year:"numeric"})}function Y(o,l){const[n,u]=o.split("-"),e=new Date(Number(n),Number(u)-1+l,1),d=String(e.getMonth()+1).padStart(2,"0");return`${e.getFullYear()}-${d}`}function it(o,l,n){let u,e=[],d=[],S="",b=!1,h=!1,N=!1,m="",B=!1;async function T(){try{n(4,S="");const a=m?`?start=${m}`:"",s=await ot(`/reports/income-matrix${a}`);n(0,e=(s==null?void 0:s.groups)||[]),n(1,d=((s==null?void 0:s.months)||[]).map(c=>({key:c,label:ct(c)}))),n(5,h=!!(s!=null&&s.has_older)),n(6,N=!!(s!=null&&s.has_newer)),n(3,m=(s==null?void 0:s.start_month)||m)}catch(a){n(4,S=a.message||"Failed to load.")}}K(async()=>{n(8,B=!0),await T()});function _(){b=this.checked,n(2,b)}const U=()=>n(3,m=Y(m||new Date().toISOString().slice(0,7),-12)),O=()=>n(3,m=Y(m||new Date().toISOString().slice(0,7),12)),q=()=>{const a=e==null?void 0:e.find(c=>c.group==="Income"),s=e==null?void 0:e.find(c=>c.group==="Expense");return!a||!s?null:Object.fromEntries(d.map(c=>{var w,p;return[c.key,(((w=a.monthly_balances)==null?void 0:w[c.key])||0)-(((p=s.monthly_balances)==null?void 0:p[c.key])||0)]}))};return o.$$.update=()=>{o.$$.dirty&264&&B&&T(),o.$$.dirty&7&&n(7,u=b?e:e.map(a=>{const s=(a.parents||[]).map(c=>{const w=(c.accounts||[]).filter(g=>d.some(I=>{var i;const P=((i=g.monthly_balances)==null?void 0:i[I.key])??0;return Math.abs(Number(P)||0)>.005}));return d.some(g=>{var P;const I=((P=c.monthly_balances)==null?void 0:P[g.key])??0;return Math.abs(Number(I)||0)>.005})||w.length>0?{...c,accounts:w}:null}).filter(Boolean);return{...a,parents:s}}).filter(a=>a.parents&&a.parents.length>0))},[e,d,b,m,S,h,N,u,B,_,U,O,q]}class pt extends Q{constructor(l){super(),R(this,l,it,at,z,{})}}export{pt as component};
