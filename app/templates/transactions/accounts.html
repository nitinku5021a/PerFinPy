{% extends "base.html" %}

{% block title %}Chart of Accounts - Personal Finance Accounting{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Chart of Accounts</h1>
    <a href="{{ url_for('transactions.new_account') }}" class="btn btn-primary">New Account</a>
</div>

{% if accounts %}
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Opening</th>
            <th>Description</th>
            <th style="text-align: right;">Balance</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for account in accounts %}
            {% if account.parent_id is none %}
                <!-- Parent/Group account -->
                <tr style="background-color: #f0f0f0; font-weight: bold;">
                    <td>{{ account.name|camelcase }}</td>
                    <td>{{ account.account_type }}</td>
                    <td style="text-align: right;">{{ account.opening_balance|inr }}</td>
                    <td>{{ account.description or '-' }}</td>
                    <td style="text-align: right;">{{ account.get_group_balance()|inr }}</td>
                    <td>{% if account.is_active %}<span class="badge badge-active">Active</span>{% else %}<span class="badge badge-inactive">Inactive</span>{% endif %}</td>
                    <td><a href="{{ url_for('transactions.edit_account', id=account.id) }}" class="btn btn-small">Edit</a></td>
                </tr>
                <!-- Child accounts -->
                {% for child in account.children %}
                <tr>
                    <td style="padding-left: 20px;">├─ {{ child.name|camelcase }}</td>
                    <td>{{ child.account_type }}</td>
                    <td>{{ child.description or '-' }}</td>
                    <td style="text-align: right;">{{ (child.get_group_balance() if child.is_group() else child.get_balance())|inr }}</td>
                    <td>{% if child.is_active %}<span class="badge badge-active">Active</span>{% else %}<span class="badge badge-inactive">Inactive</span>{% endif %}</td>
                    <td><a href="{{ url_for('transactions.edit_account', id=child.id) }}" class="btn btn-small">Edit</a></td>
                </tr>
                    {% for gc in child.children %}
                    <tr>
                        <td style="padding-left: 40px;">└─ {{ gc.name|camelcase }}</td>
                        <td>{{ gc.account_type }}</td>
                        <td>{{ gc.description or '-' }}</td>
                        <td style="text-align: right;">{{ gc.get_balance()|inr }}</td>
                        <td>{% if gc.is_active %}<span class="badge badge-active">Active</span>{% else %}<span class="badge badge-inactive">Inactive</span>{% endif %}</td>
                    </tr>
                    {% endfor %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No accounts found. <a href="{{ url_for('transactions.new_account') }}">Create one</a></p>
{% endif %}
{% endblock %}
