{% extends "base.html" %}

{% block title %}Import Transactions - Personal Finance Accounting{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Import Transactions from Excel</h1>
    <a href="{{ url_for('transactions.export_transactions') }}" class="btn btn-secondary" style="margin-left: 10px;">Export Transactions (Excel)</a>
</div>

<div class="import-help" style="background-color: #f9f9f9; padding: 15px; margin-bottom: 20px; border-left: 4px solid #007bff;">
    <h3>Excel File Format</h3>
    <p>Your Excel file should have the following columns (starting from row 2):</p>
    <ol>
        <li><strong>Date</strong> - Format: DD-MM-YYYY (e.g., 02-08-2012)</li>
        <li><strong>Debit Account</strong> - Hierarchical format: TopLevel:MiddleLevel:Account (e.g., Expense:Grocery:Fruits)</li>
        <li><strong>Description</strong> - Transaction description (e.g., Apple (3.5 kg))</li>
        <li><strong>Amount</strong> - Numeric amount in Rs (e.g., 540)</li>
        <li><strong>Credit Account</strong> - Hierarchical format: TopLevel:MiddleLevel:Account (e.g., Asset:Saving Bank Account:Cash)</li>
    </ol>
    <p><strong>Example:</strong></p>
    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
        <tr style="background-color: #e9ecef;">
            <td style="border: 1px solid #ddd; padding: 8px;">02-08-2012</td>
            <td style="border: 1px solid #ddd; padding: 8px;">Expense:Grocery:Fruits</td>
            <td style="border: 1px solid #ddd; padding: 8px;">Apple (3.5 kg)</td>
            <td style="border: 1px solid #ddd; padding: 8px;">540</td>
            <td style="border: 1px solid #ddd; padding: 8px;">Asset:Saving Bank Account:Cash</td>
        </tr>
    </table>
    <p style="margin-top: 10px; color: #666;">
        <strong>Note:</strong> Accounts are created automatically based on the hierarchy. Max 2 levels of grouping supported.
    </p>
</div>

{% if results %}
    <div class="results-section" style="background-color: #f0f8ff; padding: 15px; margin-bottom: 20px; border: 1px solid #b0d4ff; border-radius: 4px;">
        <h3>Import Results</h3>
        <p><strong>Successfully imported:</strong> {{ results.success }} transactions</p>
        {% if results.total_rows %}
        <p><strong>Total rows processed:</strong> {{ results.total_rows }}</p>
        {% endif %}
        
        {% if results.errors %}
            <div style="margin-top: 15px;">
                <h4 style="color: #d9534f;">Errors ({{ results.errors|length }}):</h4>
                <ul style="color: #d9534f;">
                    {% for error in results.errors[:20] %}
                        <li>{{ error }}</li>
                    {% endfor %}
                    {% if results.errors|length > 20 %}
                        <li>... and {{ results.errors|length - 20 }} more errors</li>
                    {% endif %}
                </ul>
            </div>
        {% endif %}
        
        {% if results.warnings %}
            <div style="margin-top: 15px;">
                <h4 style="color: #f0ad4e;">Warnings:</h4>
                <ul style="color: #f0ad4e;">
                    {% for warning in results.warnings %}
                        <li>{{ warning }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        <div style="margin-top: 15px;">
            <a href="{{ url_for('transactions.list_transactions') }}" class="btn btn-primary">View Transactions</a>
            <a href="{{ url_for('transactions.list_accounts') }}" class="btn btn-secondary">View Accounts</a>
            <a href="{{ url_for('transactions.import_transactions') }}" class="btn btn-secondary">Import More</a>
        </div>
    </div>
{% endif %}

<div class="import-form" style="background-color: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 4px;">
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file">Select Excel File (.xlsx or .xls):</label>
            <input type="file" id="file" name="file" accept=".xlsx,.xls" required>
            <small>Maximum file size: 10MB. Supported formats: .xlsx, .xls</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Import Transactions</button>
            <a href="{{ url_for('transactions.list_transactions') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
    .import-help {
        border-radius: 4px;
    }
    
    .import-form {
        max-width: 600px;
    }
    
    .results-section h3, .import-help h3 {
        margin-top: 0;
    }
</style>
{% endblock %}
