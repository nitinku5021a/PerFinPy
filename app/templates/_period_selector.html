{# Reusable period filter: All time, YTD, Current month, and custom From/To calendar. #}
{# Expects: period (current value), optional start_date, end_date for display. Uses request.path and request.args for URLs. #}
<div class="period-selector-wrap" data-base-url="{{ request.path }}" data-period="{{ period }}"
     data-extra-params="{{ request.args.to_dict()|tojson }}">
    <div class="period-quick-row">
        <span class="period-quick-label">Period:</span>
        <a href="{{ request.path }}?period=all{% for k, v in request.args.items() %}{% if k not in ['period', 'page'] %}&{{ k }}={{ v }}{% endif %}{% endfor %}"
           class="period-quick-btn{% if period == 'all' %} active{% endif %}">All time</a>
        <a href="{{ request.path }}?period=ytd{% for k, v in request.args.items() %}{% if k not in ['period', 'page'] %}&{{ k }}={{ v }}{% endif %}{% endfor %}"
           class="period-quick-btn{% if period == 'ytd' %} active{% endif %}">YTD</a>
        <a href="{{ request.path }}?period=current_month{% for k, v in request.args.items() %}{% if k not in ['period', 'page'] %}&{{ k }}={{ v }}{% endif %}{% endfor %}"
           class="period-quick-btn{% if period == 'current_month' %} active{% endif %}">Current month</a>
    </div>
    <div class="period-date-row">
        <label class="period-date-label">Date range</label>
        <button type="button" class="period-date-display" id="periodDateDisplay" aria-haspopup="true" aria-expanded="false">
            <span class="period-date-text">
                {% if period == 'all' %}All time
                {% elif period == 'ytd' %}YTD
                {% elif period == 'current_month' %}Current month
                {% elif period.startswith('custom_') and start_date is defined and end_date is defined %}{{ start_date.strftime('%Y-%m-%d') }} ~ {{ end_date.strftime('%Y-%m-%d') }}
                {% elif period.startswith('custom_') %}{{ period }}
                {% else %}{{ period }}{% endif %}
            </span>
            <span class="period-date-arrow">▼</span>
        </button>
        <div class="period-calendar-popover" id="periodCalendarPopover" role="dialog" aria-label="Choose date range" hidden>
            <div class="period-calendar-quick">
                <button type="button" class="period-calendar-quick-btn" data-from="-7" data-to="0">Last 7 days</button>
                <button type="button" class="period-calendar-quick-btn" data-from="-30" data-to="0">Last 30 days</button>
                <button type="button" class="period-calendar-quick-btn" data-fy="prev">Prev. FY</button>
                <button type="button" class="period-calendar-quick-btn" data-fy="current">Current FY</button>
            </div>
            <div class="period-calendar-dual">
                <div class="period-calendar-panel">
                    <div class="period-calendar-header">
                        <span class="period-calendar-title">From</span>
                        <div class="period-calendar-nav">
                            <button type="button" class="period-calendar-nav-btn" data-panel="from" data-dir="year-prev" aria-label="Previous year">«</button>
                            <button type="button" class="period-calendar-nav-btn" data-panel="from" data-dir="prev" aria-label="Previous month">‹</button>
                            <span class="period-calendar-month" id="periodFromMonthLabel">—</span>
                            <button type="button" class="period-calendar-nav-btn" data-panel="from" data-dir="next" aria-label="Next month">›</button>
                            <button type="button" class="period-calendar-nav-btn" data-panel="from" data-dir="year-next" aria-label="Next year">»</button>
                        </div>
                    </div>
                    <div class="period-calendar-grid" id="periodFromCalendar" data-panel="from"></div>
                </div>
                <div class="period-calendar-panel">
                    <div class="period-calendar-header">
                        <span class="period-calendar-title">To</span>
                        <div class="period-calendar-nav">
                            <button type="button" class="period-calendar-nav-btn" data-panel="to" data-dir="year-prev" aria-label="Previous year">«</button>
                            <button type="button" class="period-calendar-nav-btn" data-panel="to" data-dir="prev" aria-label="Previous month">‹</button>
                            <span class="period-calendar-month" id="periodToMonthLabel">—</span>
                            <button type="button" class="period-calendar-nav-btn" data-panel="to" data-dir="next" aria-label="Next month">›</button>
                            <button type="button" class="period-calendar-nav-btn" data-panel="to" data-dir="year-next" aria-label="Next year">»</button>
                        </div>
                    </div>
                    <div class="period-calendar-grid" id="periodToCalendar" data-panel="to"></div>
                </div>
            </div>
            <div class="period-calendar-actions">
                <button type="button" class="btn btn-secondary period-calendar-cancel" id="periodCalendarCancel">Cancel</button>
                <button type="button" class="btn btn-primary period-calendar-apply" id="periodCalendarApply">Apply</button>
            </div>
        </div>
    </div>
</div>
